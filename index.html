<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Personal Finance Manager</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <!-- Favicon -->
        <link rel="icon" href="assets/logo.png" type="image/x-icon" />
        <link rel="apple-touch-icon" sizes="180x180" href="assets/logo.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="assets/logo.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="assets/logo.png" />
        <link rel="manifest" href="/manifest.json" />
        <!-- Required for iOS to launch standalone -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="Lists" />
        <!-- iOS home screen icon -->
        <link rel="apple-touch-icon" href="/your-repo-name/assets/logo.png" />
        <style>
            /* CSS Reset & Base Styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            }

            :root {
                --primary-color: #3498db;
                --secondary-color: #2c3e50;
                --success-color: #2ecc71;
                --danger-color: #e74c3c;
                --warning-color: #f39c12;
                --light-color: #ecf0f1;
                /* --dark-color: #2c3e50; */
                --dark-color: #0d1727;
                --gray-color: #95a5a6;
                --border-radius: 8px;
                --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                --transition: all 0.3s ease;
            }

            body {
                background-color: var(--light-color);
                color: var(--dark-color);
                line-height: 1.6;
                transition: var(--transition);
                padding-bottom: 20px;
                min-height: 100vh;
            }

            body.dark-theme {
                background-color: var(--dark-color);
                color: var(--light-color);
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 15px;
            }

            header {
                background-color: var(--primary-color);
                color: white;
                padding: 20px 0;
                box-shadow: var(--box-shadow);
                margin-bottom: 30px;
            }

            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                margin-bottom: 20px;
                color: var(--primary-color);
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 8px;
            }

            .dark-theme h2 {
                color: var(--light-color);
                border-bottom-color: var(--light-color);
            }

            /* Theme Toggle */
            .theme-toggle {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .theme-switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 30px;
            }

            .theme-switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--secondary-color);
                transition: var(--transition);
                border-radius: 30px;
            }

            .slider:before {
                position: absolute;
                content: "";
                height: 22px;
                width: 22px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: var(--transition);
                border-radius: 50%;
            }

            input:checked + .slider {
                background-color: var(--light-color);
            }

            input:checked + .slider:before {
                transform: translateX(30px);
                background-color: var(--dark-color);
            }

            /* Tab Navigation */
            .tabs {
                display: flex;
                background-color: white;
                border-radius: var(--border-radius);
                overflow: hidden;
                box-shadow: var(--box-shadow);
                margin-bottom: 30px;
            }

            .dark-theme .tabs {
                background-color: #34495e;
            }

            .tab {
                flex: 1;
                padding: 15px;
                text-align: center;
                cursor: pointer;
                font-weight: 600;
                transition: var(--transition);
                border-bottom: 3px solid transparent;
            }

            .tab:hover {
                background-color: rgba(52, 152, 219, 0.1);
            }

            .dark-theme .tab:hover {
                background-color: rgba(236, 240, 241, 0.1);
            }

            .tab.active {
                border-bottom: 3px solid var(--primary-color);
                color: var(--primary-color);
            }

            /* Tab Content */
            .tab-content {
                display: none;
                animation: fadeIn 0.5s;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            .tab-content.active {
                display: block;
            }

            /* Dashboard */
            .summary-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .card {
                background-color: white;
                border-radius: var(--border-radius);
                padding: 20px;
                box-shadow: var(--box-shadow);
                transition: var(--transition);
            }

            .dark-theme .card {
                /* background-color: #34495e; */
                background-color: #152947;
            }

            .card:hover {
                transform: translateY(-5px);
            }

            .card h3 {
                font-size: 1rem;
                margin-bottom: 10px;
                color: var(--gray-color);
            }

            .card .amount {
                font-size: 1.8rem;
                font-weight: 700;
            }

            .income-amount {
                color: var(--success-color);
            }

            .expenses-amount {
                color: var(--danger-color);
            }

            .balance-amount {
                color: var(--primary-color);
            }

            .wealth-amount {
                color: var(--warning-color);
            }

            /* Transaction and Wealth Sections */
            .section-container {
                display: grid;
                grid-template-columns: 1fr;
                gap: 30px;
            }

            @media (min-width: 768px) {
                .section-container {
                    grid-template-columns: 1fr 1fr;
                }
            }

            .form-container {
                background-color: white;
                border-radius: var(--border-radius);
                padding: 20px;
                box-shadow: var(--box-shadow);
            }

            .dark-theme .form-container {
                background-color: #152947;
                color: var(--light-color);
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                display: block;
                margin-bottom: 5px;
                font-weight: 600;
            }

            input,
            select {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 1rem;
                transition: var(--transition);
            }

            .dark-theme input,
            .dark-theme select {
                background-color: #152947;
                border-color: #4a5f7a;
                color: var(--light-color);
            }

            input:focus,
            select:focus {
                outline: none;
                border-color: var(--primary-color);
            }

            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: var(--border-radius);
                cursor: pointer;
                font-weight: 600;
                transition: var(--transition);
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background-color: var(--primary-color);
                color: white;
            }

            .btn-primary:hover {
                background-color: #2980b9;
            }

            .btn-danger {
                background-color: var(--danger-color);
                color: white;
            }

            .btn-danger:hover {
                background-color: #c0392b;
            }

            .btn-success {
                background-color: var(--success-color);
                color: white;
            }

            .btn-success:hover {
                background-color: #27ae60;
            }

            .btn-warning {
                background-color: var(--warning-color);
                color: white;
            }

            .btn-warning:hover {
                background-color: #d68910;
            }

            /* Category Badge */
            .category-badge {
                display: inline-block;
                padding: 3px 10px;
                border-radius: 15px;
                font-size: 0.8rem;
                font-weight: 600;
                margin-left: 8px;
                background-color: var(--light-color);
                color: var(--dark-color);
            }

            .dark-theme .category-badge {
                background-color: #34495e;
                color: var(--light-color);
            }

            /* List Container */
            .list-container {
                background-color: white;
                border-radius: var(--border-radius);
                padding: 20px;
                box-shadow: var(--box-shadow);
                max-height: 400px;
                overflow-y: auto;
                margin-top: 1rem;
            }

            .dark-theme .list-container {
                background-color: #152947;
                color: var(--light-color);
            }

            .list-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .list-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid #eee;
            }

            .dark-theme .list-item {
                border-bottom-color: #4a5f7a;
            }

            .list-item:last-child {
                border-bottom: none;
            }

            .list-item-description {
                font-weight: 600;
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                gap: 8px;
            }

            .list-item-amount {
                font-weight: 700;
            }

            .income-item .list-item-amount {
                color: var(--success-color);
            }

            .expense-item .list-item-amount {
                color: var(--danger-color);
            }

            .asset-item .list-item-amount {
                color: var(--success-color);
            }

            .liability-item .list-item-amount {
                color: var(--danger-color);
            }

            .list-item-actions {
                display: flex;
                gap: 10px;
            }

            .action-btn {
                background: none;
                border: none;
                cursor: pointer;
                font-size: 1rem;
                transition: var(--transition);
                color: var(--gray-color);
            }

            .action-btn:hover {
                color: var(--primary-color);
            }

            .edit-btn:hover {
                color: var(--warning-color);
            }

            .delete-btn:hover {
                color: var(--danger-color);
            }

            /* Category Select Group */
            .category-group {
                display: flex;
                gap: 10px;
                align-items: flex-end;
            }

            .category-group select {
                flex: 3;
            }

            .category-group input {
                flex: 2;
            }

            /* Category Management */
            .category-management {
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid #ddd;
            }

            .dark-theme .category-management {
                border-top-color: #4a5f7a;
            }

            .category-lists {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .category-card {
                background-color: white;
                border-radius: var(--border-radius);
                padding: 15px;
                box-shadow: var(--box-shadow);
            }

            .dark-theme .category-card {
                background-color: #152947;
            }

            .category-card h4 {
                margin-bottom: 10px;
                color: var(--primary-color);
                padding-bottom: 5px;
                border-bottom: 1px solid #eee;
            }

            .dark-theme .category-card h4 {
                color: var(--light-color);
                border-bottom-color: #4a5f7a;
            }

            .category-list {
                list-style-type: none;
            }

            .category-list li {
                padding: 5px 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .delete-category-btn {
                background: none;
                border: none;
                color: var(--danger-color);
                cursor: pointer;
                font-size: 0.8rem;
            }

            /* Data Management */
            .data-management {
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid #ddd;
            }

            .dark-theme .data-management {
                border-top-color: #4a5f7a;
            }

            .data-buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 15px;
            }

            /* Empty State */
            .empty-state {
                text-align: center;
                padding: 30px;
                color: var(--gray-color);
            }

            .empty-state i {
                font-size: 3rem;
                margin-bottom: 15px;
                opacity: 0.5;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .header-content {
                    flex-direction: column;
                    gap: 15px;
                }

                .tabs {
                    flex-direction: column;
                }

                .data-buttons {
                    flex-direction: column;
                }

                .data-buttons .btn {
                    width: 100%;
                }

                .category-group {
                    flex-direction: column;
                    align-items: stretch;
                }
            }

            @media (max-width: 480px) {
                h1 {
                    font-size: 1.5rem;
                }

                .card .amount {
                    font-size: 1.5rem;
                }

                .list-item {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }

                .list-item-actions {
                    align-self: flex-end;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <div class="container">
                <div class="header-content">
                    <h1><i class="fas fa-wallet"></i> Personal Finance Manager</h1>
                    <div class="theme-toggle">
                        <i class="fas fa-sun"></i>
                        <label class="theme-switch">
                            <input type="checkbox" id="themeToggle" />
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon"></i>
                    </div>
                </div>
            </div>
        </header>

        <main class="container">
            <!-- Tab Navigation -->
            <div class="tabs">
                <div class="tab active" data-tab="dashboard">Dashboard</div>
                <div class="tab" data-tab="transactions">Monthly Transactions</div>
                <div class="tab" data-tab="wealth">Wealth</div>
                <div class="tab" data-tab="categories">Categories</div>
                <div class="tab" data-tab="data">Data Management</div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Financial Overview</h2>

                <div class="summary-cards">
                    <div class="card">
                        <h3>Monthly Income</h3>
                        <div class="amount income-amount" id="totalIncome">£0.00</div>
                    </div>

                    <div class="card">
                        <h3>Monthly Expenses</h3>
                        <div class="amount expenses-amount" id="totalExpenses">£0.00</div>
                    </div>

                    <div class="card">
                        <h3>Monthly Balance</h3>
                        <div class="amount balance-amount" id="monthlyBalance">£0.00</div>
                    </div>

                    <div class="card">
                        <h3>Total Net Wealth</h3>
                        <div class="amount wealth-amount" id="totalWealth">£0.00</div>
                    </div>
                </div>

                <!-- <div class="card">
                <h3>Recent Transactions</h3>
                <div id="recentTransactions" class="empty-state">
                    <i class="fas fa-exchange-alt"></i>
                    <p>No transactions yet. Add some in the Transactions tab.</p>
                </div>
            </div> -->
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content">
                <h2>Monthly Transactions</h2>

                <div class="section-container">
                    <!-- Income Form -->
                    <div class="form-container">
                        <h3>Add Income</h3>
                        <form id="incomeForm">
                            <div class="form-group">
                                <label for="incomeDescription">Description</label>
                                <input
                                    type="text"
                                    id="incomeDescription"
                                    placeholder="Salary, Freelance, etc."
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="incomeAmount">Amount (£)</label>
                                <input
                                    type="number"
                                    id="incomeAmount"
                                    min="0"
                                    step="0.01"
                                    placeholder="0.00"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="incomeCategory">Category</label>
                                <div class="category-group">
                                    <select id="incomeCategorySelect">
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                    <input
                                        type="text"
                                        id="incomeCategoryCustom"
                                        placeholder="Custom category"
                                        style="display: none"
                                    />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Add Income
                            </button>
                        </form>
                    </div>

                    <!-- Expenses Form -->
                    <div class="form-container">
                        <h3>Add Expense</h3>
                        <form id="expenseForm">
                            <div class="form-group">
                                <label for="expenseDescription">Description</label>
                                <input
                                    type="text"
                                    id="expenseDescription"
                                    placeholder="Rent, Groceries, etc."
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="expenseAmount">Amount (£)</label>
                                <input
                                    type="number"
                                    id="expenseAmount"
                                    min="0"
                                    step="0.01"
                                    placeholder="0.00"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="expenseCategory">Category</label>
                                <div class="category-group">
                                    <select id="expenseCategorySelect">
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                    <input
                                        type="text"
                                        id="expenseCategoryCustom"
                                        placeholder="Custom category"
                                        style="display: none"
                                    />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Add Expense
                            </button>
                        </form>
                    </div>
                </div>

                <div class="section-container">
                    <!-- Income List -->
                    <div class="list-container">
                        <div class="list-header">
                            <h3>Income Sources</h3>
                            <span id="incomeCount">0 items</span>
                        </div>
                        <div id="incomeList" class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <p>No income sources added yet.</p>
                        </div>
                    </div>

                    <!-- Expenses List -->
                    <div class="list-container">
                        <div class="list-header">
                            <h3>Expenses</h3>
                            <span id="expenseCount">0 items</span>
                        </div>
                        <div id="expenseList" class="empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <p>No expenses added yet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wealth Tab -->
            <div id="wealth" class="tab-content">
                <h2>Wealth Management</h2>

                <div class="section-container">
                    <!-- Assets Form -->
                    <div class="form-container">
                        <h3>Add Asset</h3>
                        <form id="assetForm">
                            <div class="form-group">
                                <label for="assetDescription">Description</label>
                                <input
                                    type="text"
                                    id="assetDescription"
                                    placeholder="Savings, Investments, Property, etc."
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="assetAmount">Value (£)</label>
                                <input type="number" id="assetAmount" min="0" step="0.01" placeholder="0.00" required />
                            </div>

                            <div class="form-group">
                                <label for="assetCategory">Category</label>
                                <div class="category-group">
                                    <select id="assetCategorySelect">
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                    <input
                                        type="text"
                                        id="assetCategoryCustom"
                                        placeholder="Custom category"
                                        style="display: none"
                                    />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Add Asset
                            </button>
                        </form>
                    </div>

                    <!-- Liabilities Form -->
                    <div class="form-container">
                        <h3>Add Liability</h3>
                        <form id="liabilityForm">
                            <div class="form-group">
                                <label for="liabilityDescription">Description</label>
                                <input
                                    type="text"
                                    id="liabilityDescription"
                                    placeholder="Mortgage, Car Loan, Credit Card, etc."
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="liabilityAmount">Amount Owed (£)</label>
                                <input
                                    type="number"
                                    id="liabilityAmount"
                                    min="0"
                                    step="0.01"
                                    placeholder="0.00"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="liabilityCategory">Category</label>
                                <div class="category-group">
                                    <select id="liabilityCategorySelect">
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                    <input
                                        type="text"
                                        id="liabilityCategoryCustom"
                                        placeholder="Custom category"
                                        style="display: none"
                                    />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Add Liability
                            </button>
                        </form>
                    </div>
                </div>

                <div class="section-container">
                    <!-- Assets List -->
                    <div class="list-container">
                        <div class="list-header">
                            <h3>Assets</h3>
                            <span id="assetCount">0 items</span>
                        </div>
                        <div id="assetList" class="empty-state">
                            <i class="fas fa-home"></i>
                            <p>No assets added yet.</p>
                        </div>
                    </div>

                    <!-- Liabilities List -->
                    <div class="list-container">
                        <div class="list-header">
                            <h3>Liabilities</h3>
                            <span id="liabilityCount">0 items</span>
                        </div>
                        <div id="liabilityList" class="empty-state">
                            <i class="fas fa-credit-card"></i>
                            <p>No liabilities added yet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories Tab -->
            <div id="categories" class="tab-content">
                <h2>Category Management</h2>

                <div class="card">
                    <h3>Manage Categories</h3>
                    <p>Add, edit, or delete categories for income, expenses, assets, and liabilities.</p>

                    <div class="category-management">
                        <h4>Add New Category</h4>
                        <div class="form-group">
                            <label for="newCategoryType">Type</label>
                            <select id="newCategoryType">
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                                <option value="asset">Asset</option>
                                <option value="liability">Liability</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newCategoryName">Category Name</label>
                            <input type="text" id="newCategoryName" placeholder="Enter category name" />
                        </div>
                        <button id="addCategoryBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>

                    <div class="category-management">
                        <h4>Current Categories</h4>
                        <div class="category-lists" id="categoryLists">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Management Tab -->
            <div id="data" class="tab-content">
                <h2>Data Management</h2>

                <div class="card">
                    <h3>Export & Import Data</h3>
                    <p>Export your financial data as a JSON file or import previously saved data.</p>

                    <div class="data-management">
                        <h4>Export Data</h4>
                        <p>Download a JSON file containing all your financial data and categories.</p>
                        <div class="data-buttons">
                            <button id="exportData" class="btn btn-success">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                        </div>
                    </div>

                    <div class="data-management">
                        <h4>Import Data</h4>
                        <p>Upload a previously exported JSON file to restore your data.</p>
                        <div class="data-buttons">
                            <input type="file" id="importFile" accept=".json" style="display: none" />
                            <button id="importData" class="btn btn-warning">
                                <i class="fas fa-upload"></i> Import Data
                            </button>
                        </div>
                    </div>

                    <div class="data-management">
                        <h4>Clear Data</h4>
                        <p>Warning: This will permanently delete all your financial data.</p>
                        <div class="data-buttons">
                            <button id="clearData" class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script>
            // Application state
            const state = {
                income: [],
                expenses: [],
                assets: [],
                liabilities: [],
                categories: {
                    income: ["Salary", "Freelance", "Investment", "Gift", "Business", "Other"],
                    expense: ["Housing", "Food", "Transportation", "Utilities", "Entertainment", "Healthcare", "Other"],
                    asset: ["Cash", "Savings Account", "Investment", "Real Estate", "Vehicle", "Other"],
                    liability: ["Mortgage", "Car Loan", "Credit Card", "Student Loan", "Personal Loan", "Other"],
                },
                editingId: null,
                editingType: null,
            };

            // DOM Elements
            const themeToggle = document.getElementById("themeToggle");
            const tabs = document.querySelectorAll(".tab");
            const tabContents = document.querySelectorAll(".tab-content");

            // Forms
            const incomeForm = document.getElementById("incomeForm");
            const expenseForm = document.getElementById("expenseForm");
            const assetForm = document.getElementById("assetForm");
            const liabilityForm = document.getElementById("liabilityForm");

            // Category select elements
            const incomeCategorySelect = document.getElementById("incomeCategorySelect");
            const incomeCategoryCustom = document.getElementById("incomeCategoryCustom");
            const expenseCategorySelect = document.getElementById("expenseCategorySelect");
            const expenseCategoryCustom = document.getElementById("expenseCategoryCustom");
            const assetCategorySelect = document.getElementById("assetCategorySelect");
            const assetCategoryCustom = document.getElementById("assetCategoryCustom");
            const liabilityCategorySelect = document.getElementById("liabilityCategorySelect");
            const liabilityCategoryCustom = document.getElementById("liabilityCategoryCustom");

            // Category management
            const newCategoryType = document.getElementById("newCategoryType");
            const newCategoryName = document.getElementById("newCategoryName");
            const addCategoryBtn = document.getElementById("addCategoryBtn");
            const categoryLists = document.getElementById("categoryLists");

            // Data management
            const exportButton = document.getElementById("exportData");
            const importButton = document.getElementById("importData");
            const importFile = document.getElementById("importFile");
            const clearButton = document.getElementById("clearData");

            // Initialize app
            document.addEventListener("DOMContentLoaded", () => {
                // Load saved data from localStorage
                loadData();

                // Populate category selectors
                populateCategorySelectors();

                // Render category management
                renderCategoryManagement();

                // Set up event listeners
                setupEventListeners();

                // Render all data
                renderAll();

                // Set initial theme
                const savedTheme = localStorage.getItem("financeTheme") || "light";
                if (savedTheme === "dark") {
                    document.body.classList.add("dark-theme");
                    themeToggle.checked = true;
                }
            });

            // Populate category selectors
            function populateCategorySelectors() {
                // Income categories
                populateCategorySelector(incomeCategorySelect, "income", "Custom...");

                // Expense categories
                populateCategorySelector(expenseCategorySelect, "expense", "Custom...");

                // Asset categories
                populateCategorySelector(assetCategorySelect, "asset", "Custom...");

                // Liability categories
                populateCategorySelector(liabilityCategorySelect, "liability", "Custom...");
            }

            function populateCategorySelector(selectElement, type, customLabel) {
                selectElement.innerHTML = "";

                // Add default categories
                state.categories[type].forEach((category) => {
                    const option = document.createElement("option");
                    option.value = category;
                    option.textContent = category;
                    selectElement.appendChild(option);
                });

                // Add "Custom" option
                const customOption = document.createElement("option");
                customOption.value = "custom";
                customOption.textContent = customLabel;
                selectElement.appendChild(customOption);
            }

            // Set up event listeners
            function setupEventListeners() {
                // Theme toggle
                themeToggle.addEventListener("change", toggleTheme);

                // Tab navigation
                tabs.forEach((tab) => {
                    tab.addEventListener("click", () => {
                        const tabId = tab.getAttribute("data-tab");
                        switchTab(tabId);
                    });
                });

                // Form submissions
                incomeForm.addEventListener("submit", handleIncomeSubmit);
                expenseForm.addEventListener("submit", handleExpenseSubmit);
                assetForm.addEventListener("submit", handleAssetSubmit);
                liabilityForm.addEventListener("submit", handleLiabilitySubmit);

                // Category select change handlers
                incomeCategorySelect.addEventListener("change", handleCategorySelectChange);
                expenseCategorySelect.addEventListener("change", handleCategorySelectChange);
                assetCategorySelect.addEventListener("change", handleCategorySelectChange);
                liabilityCategorySelect.addEventListener("change", handleCategorySelectChange);

                // Category management
                addCategoryBtn.addEventListener("click", handleAddCategory);

                // Data management
                exportButton.addEventListener("click", exportData);
                importButton.addEventListener("click", () => importFile.click());
                importFile.addEventListener("change", importData);
                clearButton.addEventListener("click", clearData);
            }

            // Handle category select change
            function handleCategorySelectChange(e) {
                const select = e.target;
                const customInputId = select.id.replace("Select", "Custom");
                const customInput = document.getElementById(customInputId);

                if (select.value === "custom") {
                    customInput.style.display = "block";
                    customInput.required = true;
                } else {
                    customInput.style.display = "none";
                    customInput.required = false;
                }
            }

            // Theme toggle function
            function toggleTheme() {
                document.body.classList.toggle("dark-theme");
                const theme = document.body.classList.contains("dark-theme") ? "dark" : "light";
                localStorage.setItem("financeTheme", theme);
            }

            // Tab switching function
            function switchTab(tabId) {
                // Update active tab
                tabs.forEach((tab) => {
                    if (tab.getAttribute("data-tab") === tabId) {
                        tab.classList.add("active");
                    } else {
                        tab.classList.remove("active");
                    }
                });

                // Update active tab content
                tabContents.forEach((content) => {
                    if (content.id === tabId) {
                        content.classList.add("active");
                    } else {
                        content.classList.remove("active");
                    }
                });
            }

            // Handle income form submission
            function handleIncomeSubmit(e) {
                e.preventDefault();

                const description = document.getElementById("incomeDescription").value.trim();
                const amount = parseFloat(document.getElementById("incomeAmount").value);
                let category = incomeCategorySelect.value;

                if (category === "custom") {
                    category = incomeCategoryCustom.value.trim();
                    if (!category) {
                        alert("Please enter a custom category");
                        return;
                    }
                    // Add custom category if it doesn't exist
                    addCustomCategory("income", category);
                }

                if (!description || isNaN(amount) || amount <= 0) {
                    alert("Please enter a valid description and amount");
                    return;
                }

                const newIncome = {
                    id: Date.now().toString(),
                    description,
                    amount,
                    category,
                    date: new Date().toISOString().split("T")[0],
                };

                if (state.editingType === "income" && state.editingId) {
                    // Update existing income
                    const index = state.income.findIndex((item) => item.id === state.editingId);
                    if (index !== -1) {
                        state.income[index] = { ...state.income[index], description, amount, category };
                    }
                    state.editingId = null;
                    state.editingType = null;

                    // Reset button text
                    const submitBtn = incomeForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Income';
                } else {
                    // Add new income
                    state.income.push(newIncome);
                }

                // Reset form
                incomeForm.reset();
                incomeCategoryCustom.style.display = "none";
                incomeCategoryCustom.required = false;

                // Save and render
                saveData();
                renderAll();
                populateCategorySelectors();
            }

            // Handle expense form submission
            function handleExpenseSubmit(e) {
                e.preventDefault();

                const description = document.getElementById("expenseDescription").value.trim();
                const amount = parseFloat(document.getElementById("expenseAmount").value);
                let category = expenseCategorySelect.value;

                if (category === "custom") {
                    category = expenseCategoryCustom.value.trim();
                    if (!category) {
                        alert("Please enter a custom category");
                        return;
                    }
                    // Add custom category if it doesn't exist
                    addCustomCategory("expense", category);
                }

                if (!description || isNaN(amount) || amount <= 0) {
                    alert("Please enter a valid description and amount");
                    return;
                }

                const newExpense = {
                    id: Date.now().toString(),
                    description,
                    amount,
                    category,
                    date: new Date().toISOString().split("T")[0],
                };

                if (state.editingType === "expense" && state.editingId) {
                    // Update existing expense
                    const index = state.expenses.findIndex((item) => item.id === state.editingId);
                    if (index !== -1) {
                        state.expenses[index] = { ...state.expenses[index], description, amount, category };
                    }
                    state.editingId = null;
                    state.editingType = null;

                    // Reset button text
                    const submitBtn = expenseForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Expense';
                } else {
                    // Add new expense
                    state.expenses.push(newExpense);
                }

                // Reset form
                expenseForm.reset();
                expenseCategoryCustom.style.display = "none";
                expenseCategoryCustom.required = false;

                // Save and render
                saveData();
                renderAll();
                populateCategorySelectors();
            }

            // Handle asset form submission
            function handleAssetSubmit(e) {
                e.preventDefault();

                const description = document.getElementById("assetDescription").value.trim();
                const amount = parseFloat(document.getElementById("assetAmount").value);
                let category = assetCategorySelect.value;

                if (category === "custom") {
                    category = assetCategoryCustom.value.trim();
                    if (!category) {
                        alert("Please enter a custom category");
                        return;
                    }
                    // Add custom category if it doesn't exist
                    addCustomCategory("asset", category);
                }

                if (!description || isNaN(amount) || amount <= 0) {
                    alert("Please enter a valid description and amount");
                    return;
                }

                const newAsset = {
                    id: Date.now().toString(),
                    description,
                    amount,
                    category,
                };

                if (state.editingType === "asset" && state.editingId) {
                    // Update existing asset
                    const index = state.assets.findIndex((item) => item.id === state.editingId);
                    if (index !== -1) {
                        state.assets[index] = { ...state.assets[index], description, amount, category };
                    }
                    state.editingId = null;
                    state.editingType = null;

                    // Reset button text
                    const submitBtn = assetForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Asset';
                } else {
                    // Add new asset
                    state.assets.push(newAsset);
                }

                // Reset form
                assetForm.reset();
                assetCategoryCustom.style.display = "none";
                assetCategoryCustom.required = false;

                // Save and render
                saveData();
                renderAll();
                populateCategorySelectors();
            }

            // Handle liability form submission
            function handleLiabilitySubmit(e) {
                e.preventDefault();

                const description = document.getElementById("liabilityDescription").value.trim();
                const amount = parseFloat(document.getElementById("liabilityAmount").value);
                let category = liabilityCategorySelect.value;

                if (category === "custom") {
                    category = liabilityCategoryCustom.value.trim();
                    if (!category) {
                        alert("Please enter a custom category");
                        return;
                    }
                    // Add custom category if it doesn't exist
                    addCustomCategory("liability", category);
                }

                if (!description || isNaN(amount) || amount <= 0) {
                    alert("Please enter a valid description and amount");
                    return;
                }

                const newLiability = {
                    id: Date.now().toString(),
                    description,
                    amount,
                    category,
                };

                if (state.editingType === "liability" && state.editingId) {
                    // Update existing liability
                    const index = state.liabilities.findIndex((item) => item.id === state.editingId);
                    if (index !== -1) {
                        state.liabilities[index] = { ...state.liabilities[index], description, amount, category };
                    }
                    state.editingId = null;
                    state.editingType = null;

                    // Reset button text
                    const submitBtn = liabilityForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Liability';
                } else {
                    // Add new liability
                    state.liabilities.push(newLiability);
                }

                // Reset form
                liabilityForm.reset();
                liabilityCategoryCustom.style.display = "none";
                liabilityCategoryCustom.required = false;

                // Save and render
                saveData();
                renderAll();
                populateCategorySelectors();
            }

            // Add custom category
            function addCustomCategory(type, category) {
                if (!state.categories[type].includes(category)) {
                    state.categories[type].push(category);
                    saveData();
                    renderCategoryManagement();
                }
            }

            // Handle add category button
            function handleAddCategory() {
                const type = newCategoryType.value;
                const name = newCategoryName.value.trim();

                if (!name) {
                    alert("Please enter a category name");
                    return;
                }

                if (state.categories[type].includes(name)) {
                    alert("This category already exists");
                    return;
                }

                state.categories[type].push(name);
                newCategoryName.value = "";

                saveData();
                populateCategorySelectors();
                renderCategoryManagement();
                alert(`Category "${name}" added to ${type}`);
            }

            // Delete category
            function deleteCategory(type, category) {
                if (!confirm(`Delete category "${category}"? This will NOT delete items in this category.`)) {
                    return;
                }

                // Remove from categories array
                state.categories[type] = state.categories[type].filter((c) => c !== category);

                saveData();
                populateCategorySelectors();
                renderCategoryManagement();
            }

            // Edit item function
            function editItem(id, type) {
                state.editingId = id;
                state.editingType = type;

                let item;
                if (type === "income") {
                    item = state.income.find((item) => item.id === id);
                    document.getElementById("incomeDescription").value = item.description;
                    document.getElementById("incomeAmount").value = item.amount;

                    // Set category
                    if (state.categories.income.includes(item.category)) {
                        incomeCategorySelect.value = item.category;
                        incomeCategoryCustom.style.display = "none";
                    } else {
                        incomeCategorySelect.value = "custom";
                        incomeCategoryCustom.style.display = "block";
                        incomeCategoryCustom.value = item.category;
                    }

                    const submitBtn = incomeForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Income';

                    // Switch to transactions tab
                    switchTab("transactions");
                } else if (type === "expense") {
                    item = state.expenses.find((item) => item.id === id);
                    document.getElementById("expenseDescription").value = item.description;
                    document.getElementById("expenseAmount").value = item.amount;

                    // Set category
                    if (state.categories.expense.includes(item.category)) {
                        expenseCategorySelect.value = item.category;
                        expenseCategoryCustom.style.display = "none";
                    } else {
                        expenseCategorySelect.value = "custom";
                        expenseCategoryCustom.style.display = "block";
                        expenseCategoryCustom.value = item.category;
                    }

                    const submitBtn = expenseForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Expense';

                    // Switch to transactions tab
                    switchTab("transactions");
                } else if (type === "asset") {
                    item = state.assets.find((item) => item.id === id);
                    document.getElementById("assetDescription").value = item.description;
                    document.getElementById("assetAmount").value = item.amount;

                    // Set category
                    if (state.categories.asset.includes(item.category)) {
                        assetCategorySelect.value = item.category;
                        assetCategoryCustom.style.display = "none";
                    } else {
                        assetCategorySelect.value = "custom";
                        assetCategoryCustom.style.display = "block";
                        assetCategoryCustom.value = item.category;
                    }

                    const submitBtn = assetForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Asset';

                    // Switch to wealth tab
                    switchTab("wealth");
                } else if (type === "liability") {
                    item = state.liabilities.find((item) => item.id === id);
                    document.getElementById("liabilityDescription").value = item.description;
                    document.getElementById("liabilityAmount").value = item.amount;

                    // Set category
                    if (state.categories.liability.includes(item.category)) {
                        liabilityCategorySelect.value = item.category;
                        liabilityCategoryCustom.style.display = "none";
                    } else {
                        liabilityCategorySelect.value = "custom";
                        liabilityCategoryCustom.style.display = "block";
                        liabilityCategoryCustom.value = item.category;
                    }

                    const submitBtn = liabilityForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Liability';

                    // Switch to wealth tab
                    switchTab("wealth");
                }
            }

            // Delete item function
            function deleteItem(id, type) {
                if (!confirm("Are you sure you want to delete this item?")) {
                    return;
                }

                if (type === "income") {
                    state.income = state.income.filter((item) => item.id !== id);
                } else if (type === "expense") {
                    state.expenses = state.expenses.filter((item) => item.id !== id);
                } else if (type === "asset") {
                    state.assets = state.assets.filter((item) => item.id !== id);
                } else if (type === "liability") {
                    state.liabilities = state.liabilities.filter((item) => item.id !== id);
                }

                // Reset editing if the item being edited is deleted
                if (state.editingId === id && state.editingType === type) {
                    state.editingId = null;
                    state.editingType = null;

                    // Reset form button text
                    if (type === "income") {
                        const submitBtn = incomeForm.querySelector('button[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Income';
                        incomeForm.reset();
                        incomeCategoryCustom.style.display = "none";
                    } else if (type === "expense") {
                        const submitBtn = expenseForm.querySelector('button[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Expense';
                        expenseForm.reset();
                        expenseCategoryCustom.style.display = "none";
                    } else if (type === "asset") {
                        const submitBtn = assetForm.querySelector('button[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Asset';
                        assetForm.reset();
                        assetCategoryCustom.style.display = "none";
                    } else if (type === "liability") {
                        const submitBtn = liabilityForm.querySelector('button[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Liability';
                        liabilityForm.reset();
                        liabilityCategoryCustom.style.display = "none";
                    }
                }

                // Save and render
                saveData();
                renderAll();
            }

            // Render all data
            function renderAll() {
                renderDashboard();
                renderIncomeList();
                renderExpenseList();
                renderAssetList();
                renderLiabilityList();
            }

            // Render dashboard
            function renderDashboard() {
                // Calculate totals
                const totalIncome = state.income.reduce((sum, item) => sum + item.amount, 0);
                const totalExpenses = state.expenses.reduce((sum, item) => sum + item.amount, 0);
                const monthlyBalance = totalIncome - totalExpenses;

                const totalAssets = state.assets.reduce((sum, item) => sum + item.amount, 0);
                const totalLiabilities = state.liabilities.reduce((sum, item) => sum + item.amount, 0);
                const totalWealth = totalAssets - totalLiabilities;

                // Update dashboard values
                document.getElementById("totalIncome").textContent = formatCurrency(totalIncome);
                document.getElementById("totalExpenses").textContent = formatCurrency(totalExpenses);
                document.getElementById("monthlyBalance").textContent = formatCurrency(monthlyBalance);
                document.getElementById("totalWealth").textContent = formatCurrency(totalWealth);
            }

            // Render income list
            function renderIncomeList() {
                const container = document.getElementById("incomeList");
                const countElement = document.getElementById("incomeCount");

                countElement.textContent = `${state.income.length} ${state.income.length === 1 ? "item" : "items"}`;

                if (state.income.length === 0) {
                    container.className = "empty-state";
                    container.innerHTML = `
                    <i class="fas fa-money-bill-wave"></i>
                    <p>No income sources added yet.</p>
                `;
                    return;
                }

                container.className = "";
                container.innerHTML = "";

                state.income.forEach((item) => {
                    const itemElement = document.createElement("div");
                    itemElement.className = "list-item income-item";
                    itemElement.innerHTML = `
                    <div class="list-item-description">
                        ${item.description}
                        <span class="category-badge">${item.category}</span>
                    </div>
                    <div class="list-item-info">
                        <span class="list-item-amount">${formatCurrency(item.amount)}</span>
                        <div class="list-item-actions">
                            <button class="action-btn edit-btn" onclick="editItem('${item.id}', 'income')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('${item.id}', 'income')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    container.appendChild(itemElement);
                });
            }

            // Render expense list
            function renderExpenseList() {
                const container = document.getElementById("expenseList");
                const countElement = document.getElementById("expenseCount");

                countElement.textContent = `${state.expenses.length} ${state.expenses.length === 1 ? "item" : "items"}`;

                if (state.expenses.length === 0) {
                    container.className = "empty-state";
                    container.innerHTML = `
                    <i class="fas fa-shopping-cart"></i>
                    <p>No expenses added yet.</p>
                `;
                    return;
                }

                container.className = "";
                container.innerHTML = "";

                state.expenses.forEach((item) => {
                    const itemElement = document.createElement("div");
                    itemElement.className = "list-item expense-item";
                    itemElement.innerHTML = `
                    <div class="list-item-description">
                        ${item.description}
                        <span class="category-badge">${item.category}</span>
                    </div>
                    <div class="list-item-info">
                        <span class="list-item-amount">${formatCurrency(item.amount)}</span>
                        <div class="list-item-actions">
                            <button class="action-btn edit-btn" onclick="editItem('${item.id}', 'expense')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('${item.id}', 'expense')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    container.appendChild(itemElement);
                });
            }

            // Render asset list
            function renderAssetList() {
                const container = document.getElementById("assetList");
                const countElement = document.getElementById("assetCount");

                countElement.textContent = `${state.assets.length} ${state.assets.length === 1 ? "item" : "items"}`;

                if (state.assets.length === 0) {
                    container.className = "empty-state";
                    container.innerHTML = `
                    <i class="fas fa-home"></i>
                    <p>No assets added yet.</p>
                `;
                    return;
                }

                container.className = "";
                container.innerHTML = "";

                state.assets.forEach((item) => {
                    const itemElement = document.createElement("div");
                    itemElement.className = "list-item asset-item";
                    itemElement.innerHTML = `
                    <div class="list-item-description">
                        ${item.description}
                        <span class="category-badge">${item.category}</span>
                    </div>
                    <div class="list-item-info">
                        <span class="list-item-amount">${formatCurrency(item.amount)}</span>
                        <div class="list-item-actions">
                            <button class="action-btn edit-btn" onclick="editItem('${item.id}', 'asset')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('${item.id}', 'asset')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    container.appendChild(itemElement);
                });
            }

            // Render liability list
            function renderLiabilityList() {
                const container = document.getElementById("liabilityList");
                const countElement = document.getElementById("liabilityCount");

                countElement.textContent = `${state.liabilities.length} ${
                    state.liabilities.length === 1 ? "item" : "items"
                }`;

                if (state.liabilities.length === 0) {
                    container.className = "empty-state";
                    container.innerHTML = `
                    <i class="fas fa-credit-card"></i>
                    <p>No liabilities added yet.</p>
                `;
                    return;
                }

                container.className = "";
                container.innerHTML = "";

                state.liabilities.forEach((item) => {
                    const itemElement = document.createElement("div");
                    itemElement.className = "list-item liability-item";
                    itemElement.innerHTML = `
                    <div class="list-item-description">
                        ${item.description}
                        <span class="category-badge">${item.category}</span>
                    </div>
                    <div class="list-item-info">
                        <span class="list-item-amount">${formatCurrency(item.amount)}</span>
                        <div class="list-item-actions">
                            <button class="action-btn edit-btn" onclick="editItem('${item.id}', 'liability')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('${item.id}', 'liability')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    container.appendChild(itemElement);
                });
            }

            // Render category management
            function renderCategoryManagement() {
                categoryLists.innerHTML = "";

                // Create a card for each type
                Object.keys(state.categories).forEach((type) => {
                    const typeName = type.charAt(0).toUpperCase() + type.slice(1);
                    const card = document.createElement("div");
                    card.className = "category-card";

                    let categoriesHtml = "";
                    if (state.categories[type].length === 0) {
                        categoriesHtml = '<p style="color: var(--gray-color); font-style: italic;">No categories</p>';
                    } else {
                        categoriesHtml = '<ul class="category-list">';
                        state.categories[type].forEach((category) => {
                            // Don't allow deletion of "Other" category
                            const canDelete = category !== "Other";
                            categoriesHtml += `
                            <li>
                                ${category}
                                ${
                                    canDelete
                                        ? `<button class="delete-category-btn" onclick="deleteCategory('${type}', '${category}')">
                                        <i class="fas fa-trash"></i>
                                    </button>`
                                        : ""
                                }
                            </li>
                        `;
                        });
                        categoriesHtml += "</ul>";
                    }

                    card.innerHTML = `
                    <h4>${typeName} Categories</h4>
                    ${categoriesHtml}
                `;

                    categoryLists.appendChild(card);
                });
            }

            // Format currency
            function formatCurrency(amount) {
                return new Intl.NumberFormat("en-GB", {
                    style: "currency",
                    currency: "GBP",
                    minimumFractionDigits: 2,
                }).format(amount);
            }

            // Save data to localStorage
            function saveData() {
                const data = {
                    income: state.income,
                    expenses: state.expenses,
                    assets: state.assets,
                    liabilities: state.liabilities,
                    categories: state.categories,
                    lastUpdated: new Date().toISOString(),
                };

                localStorage.setItem("personalFinanceData", JSON.stringify(data, null, 2));
            }

            // Load data from localStorage
            function loadData() {
                const savedData = localStorage.getItem("personalFinanceData");

                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        state.income = data.income || [];
                        state.expenses = data.expenses || [];
                        state.assets = data.assets || [];
                        state.liabilities = data.liabilities || [];
                        // Merge default categories with saved ones
                        if (data.categories) {
                            Object.keys(state.categories).forEach((type) => {
                                const savedCats = data.categories[type] || [];
                                // Merge and remove duplicates
                                const merged = [...new Set([...state.categories[type], ...savedCats])];
                                state.categories[type] = merged;
                            });
                        }
                    } catch (error) {
                        console.error("Error loading saved data:", error);
                        // Initialize with empty arrays if there's an error
                        state.income = [];
                        state.expenses = [];
                        state.assets = [];
                        state.liabilities = [];
                        // Keep default categories
                    }
                }
            }

            // Export data as JSON file
            function exportData() {
                const data = {
                    income: state.income,
                    expenses: state.expenses,
                    assets: state.assets,
                    liabilities: state.liabilities,
                    categories: state.categories,
                    exportedAt: new Date().toISOString(),
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: "application/json" });

                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `personal-finance-data-${new Date().toISOString().split("T")[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                alert("Data exported successfully!");
            }

            // Import data from JSON file
            function importData(event) {
                const file = event.target.files[0];

                if (!file) {
                    return;
                }

                if (!confirm("Importing data will replace your current data. Are you sure?")) {
                    event.target.value = "";
                    return;
                }

                const reader = new FileReader();

                reader.onload = function (e) {
                    try {
                        const data = JSON.parse(e.target.result);

                        // Validate the data structure
                        if (!data.income || !data.expenses || !data.assets || !data.liabilities) {
                            throw new Error("Invalid data format");
                        }

                        // Update state
                        state.income = data.income || [];
                        state.expenses = data.expenses || [];
                        state.assets = data.assets || [];
                        state.liabilities = data.liabilities || [];
                        // Update categories, merge with defaults
                        if (data.categories) {
                            Object.keys(state.categories).forEach((type) => {
                                const importedCats = data.categories[type] || [];
                                // Merge and remove duplicates
                                const merged = [...new Set([...state.categories[type], ...importedCats])];
                                state.categories[type] = merged;
                            });
                        }

                        // Save to localStorage
                        saveData();

                        // Update UI
                        populateCategorySelectors();
                        renderCategoryManagement();
                        renderAll();

                        alert("Data imported successfully!");
                    } catch (error) {
                        alert("Error importing data. Please make sure you selected a valid JSON file.");
                        console.error("Error importing data:", error);
                    }

                    // Reset file input
                    event.target.value = "";
                };

                reader.readAsText(file);
            }

            // Clear all data
            function clearData() {
                if (
                    !confirm("Are you sure you want to delete ALL your financial data? This action cannot be undone.")
                ) {
                    return;
                }

                state.income = [];
                state.expenses = [];
                state.assets = [];
                state.liabilities = [];
                // Reset categories to defaults only (keep user-added ones will be removed)
                state.categories = {
                    income: ["Salary", "Freelance", "Investment", "Gift", "Business", "Other"],
                    expense: ["Housing", "Food", "Transportation", "Utilities", "Entertainment", "Healthcare", "Other"],
                    asset: ["Cash", "Savings Account", "Investment", "Real Estate", "Vehicle", "Other"],
                    liability: ["Mortgage", "Car Loan", "Credit Card", "Student Loan", "Personal Loan", "Other"],
                };
                state.editingId = null;
                state.editingType = null;

                // Clear localStorage
                localStorage.removeItem("personalFinanceData");

                // Reset forms
                incomeForm.reset();
                expenseForm.reset();
                assetForm.reset();
                liabilityForm.reset();

                // Reset form buttons
                const incomeBtn = incomeForm.querySelector('button[type="submit"]');
                incomeBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Income';
                incomeCategoryCustom.style.display = "none";

                const expenseBtn = expenseForm.querySelector('button[type="submit"]');
                expenseBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Expense';
                expenseCategoryCustom.style.display = "none";

                const assetBtn = assetForm.querySelector('button[type="submit"]');
                assetBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Asset';
                assetCategoryCustom.style.display = "none";

                const liabilityBtn = liabilityForm.querySelector('button[type="submit"]');
                liabilityBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Liability';
                liabilityCategoryCustom.style.display = "none";

                // Update UI
                populateCategorySelectors();
                renderCategoryManagement();
                renderAll();

                alert("All data has been cleared.");
            }

            // PWA support
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("service-worker.js")
                        .then((reg) => console.log("Service Worker registered", reg))
                        .catch((err) => console.error("Service Worker registration failed", err));
                });
            }
        </script>
    </body>
</html>